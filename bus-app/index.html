<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ»å­ãƒã‚¹ãƒ€ãƒƒã‚·ãƒ¥ï¼</title>
    <style>
        body { 
            margin: 0; padding: 0; min-height: 100vh; 
            display: flex; flex-direction: column; align-items: center; 
            font-family: 'Helvetica Neue', Arial, sans-serif; color: white;
            transition: background-color 0.5s;
            background-color: #2196F3; /* åˆæœŸè‰² */
        }

        /* åˆ¤å®šã”ã¨ã®èƒŒæ™¯è‰² */
        .safe { background-color: #2196F3; } /* é’ï¼šä½™è£• */
        .hurry { background-color: #FFC107; color: #333; } /* é»„ï¼šæ€¥ã’ */
        .out { background-color: #F44336; } /* èµ¤ï¼šæ‰‹é…ã‚Œ */

        /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .container {
            width: 90%; max-width: 600px;
            text-align: center;
            padding-top: 20px;
            padding-bottom: 40px;
        }

        /* è¨­å®šã‚¨ãƒªã‚¢ï¼ˆå…±é€šã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ */
        .accordion-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            text-align: left;
            font-size: 0.9rem;
        }
        .accordion-header {
            cursor: pointer;
            font-weight: bold;
            display: flex; justify-content: space-between;
            align-items: center;
        }
        .accordion-content {
            display: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆéè¡¨ç¤º */
            margin-top: 10px;
            text-align: center;
        }
        .accordion-content.open { display: block; }
        
        .input-group { margin-bottom: 8px; text-align: left; }
        .input-group label { display: inline-block; width: 120px; }
        .input-group input { width: 50px; padding: 5px; border-radius: 4px; border: none; text-align: center; }

        /* åœ°å›³ç”»åƒ */
        .map-image {
            width: 100%;
            max-width: 400px;
            border-radius: 8px;
            border: 2px solid white;
        }

        /* ãƒ¡ã‚¤ãƒ³è¡¨ç¤º */
        .status-text { font-size: 2.5rem; font-weight: bold; margin: 10px 0; }
        .timer { font-size: 5rem; font-weight: bold; line-height: 1; margin: 10px 0; }
        .sub-info { font-size: 1.5rem; margin-top: 5px; font-weight: bold; display: flex; align-items: center; justify-content: center; }

        /* ä¹—ã‚Šå ´ãƒãƒƒã‚¸ */
        .stop-badge {
            display: inline-block;
            background: white;
            color: #333;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            line-height: 50px;
            text-align: center;
            font-weight: bold;
            font-size: 1.5rem;
            margin-left: 10px;
        }

        /* æƒ…å ±ãƒœãƒƒã‚¯ã‚¹ */
        .bus-info-box { 
            margin-top: 30px; 
            background: rgba(255,255,255,0.2); 
            padding: 20px; 
            border-radius: 15px; 
        }
        .info-row { font-size: 1.2rem; margin: 5px 0; }
        .next-next { font-size: 0.9rem; margin-top: 15px; opacity: 0.9; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 10px;}
    </style>
</head>
<body id="app-body">
    <div class="container">
        
        <div class="accordion-area">
            <div class="accordion-header" onclick="toggleAccordion('settings-content')">
                <span>âš™ï¸ ç§»å‹•æ™‚é–“ã®è¨­å®š (åˆ†)</span>
                <span>â–¼</span>
            </div>
            <div class="accordion-content" id="settings-content">
                <div class="input-group">
                    <label>2ç•ªã®ã‚Šã° ã¾ã§:</label>
                    <input type="number" id="walk-time-2" value="5" min="1" onchange="saveSettings()"> åˆ†
                </div>
                <div class="input-group">
                    <label>3ç•ªã®ã‚Šã° ã¾ã§:</label>
                    <input type="number" id="walk-time-3" value="5" min="1" onchange="saveSettings()"> åˆ†
                </div>
                <div style="font-size: 0.8rem; margin-top:5px; text-align:left;">â€»ã“ã®æ™‚é–“ã‚ˆã‚Šä½™è£•ãŒ3åˆ†æœªæº€ã«ãªã‚‹ã¨é»„è‰²ã«ãªã‚Šã¾ã™</div>
            </div>
        </div>

        <div class="accordion-area" style="background: rgba(255, 255, 255, 0.2);">
            <div class="accordion-header" onclick="toggleAccordion('map-content')">
                <span>ğŸ—ºï¸ ä¹—ã‚Šå ´ãƒãƒƒãƒ—ã‚’è¡¨ç¤º</span>
                <span>â–¼</span>
            </div>
            <div class="accordion-content" id="map-content">
                <img src="./map.png" alt="ãƒã‚¹åœåœ°å›³" class="map-image">
                <p style="font-size:0.8rem; margin-top:5px;">ç¾åœ¨åœ°ã‹ã‚‰è¿‘ã„ä¿¡å·ã‚’æ¸¡ã‚‹ã‹ç¢ºèªã—ã‚ˆã†ï¼</p>
            </div>
        </div>

        <div id="status" class="status-text">åˆ¤å®šä¸­...</div>
        <div id="timer" class="timer">--:--</div>
        
        <div class="sub-info">
            ã®ã‚Šã° <span id="stop-number" class="stop-badge">-</span>
        </div>

        <div class="bus-info-box">
            <div class="info-row">ç¾åœ¨: <span id="current-time">--:--:--</span></div>
            <div class="info-row">ç™ºè»Š: <span id="next-bus-time" style="font-weight:bold; font-size:1.8em;">--:--</span></div>
            <div class="info-row" id="day-type" style="font-size:0.9rem;">--</div>
            
            <div class="next-next">
                <div>ãã®æ¬¡ã¯...</div>
                <div id="next-next-bus">--:-- (ã®ã‚Šã°-)</div>
            </div>
        </div>
    </div>

    <script>
        // è¨­å®šã®èª­ã¿è¾¼ã¿ãƒ»ä¿å­˜
        function loadSettings() {
            const w2 = localStorage.getItem('walkTime2');
            const w3 = localStorage.getItem('walkTime3');
            if(w2) document.getElementById('walk-time-2').value = w2;
            if(w3) document.getElementById('walk-time-3').value = w3;
        }
        function saveSettings() {
            const w2 = document.getElementById('walk-time-2').value;
            const w3 = document.getElementById('walk-time-3').value;
            localStorage.setItem('walkTime2', w2);
            localStorage.setItem('walkTime3', w3);
            updateApp();
        }
        
        // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³é–‹é–‰ï¼ˆè¨­å®šã¨ãƒãƒƒãƒ—å…±é€šï¼‰
        function toggleAccordion(id) {
            document.getElementById(id).classList.toggle('open');
        }

        // çµ±åˆæ™‚åˆ»è¡¨ãƒ‡ãƒ¼ã‚¿
        const rawSchedule = {
            weekday: [
                [6,16,3], [6,17,2], [6,27,3], [6,28,2], [6,31,3], [6,32,2], [6,32,2], [6,37,3], [6,37,3], [6,38,2], [6,38,2], [6,40,3], [6,40,3], [6,41,2], [6,41,2], [6,48,3], [6,49,2], [6,49,2], [6,53,3], [6,54,2], [6,58,3], [6,58,3], [6,59,2], [6,59,2],
                [7,1,3], [7,1,3], [7,2,2], [7,2,2], [7,4,3], [7,4,3], [7,5,2], [7,5,2], [7,11,3], [7,12,2], [7,12,2], [7,16,3], [7,16,3], [7,17,2], [7,17,2], [7,22,3], [7,23,2], [7,24,3], [7,25,2], [7,25,2], [7,26,3], [7,26,3], [7,27,3], [7,27,3], [7,27,2], [7,27,2], [7,28,2], [7,28,2], [7,32,3], [7,32,3], [7,33,2], [7,33,2], [7,35,3], [7,35,3], [7,36,2], [7,36,2], [7,39,3], [7,39,3], [7,40,2], [7,40,2], [7,44,3], [7,45,2], [7,45,2], [7,46,3], [7,46,3], [7,47,2], [7,48,3], [7,48,3], [7,49,2], [7,49,2], [7,51,3], [7,51,3], [7,52,2], [7,52,2], [7,54,3], [7,54,3], [7,55,2], [7,55,2], [7,58,3], [7,58,3], [7,59,2], [7,59,2],
                [8,0,2], [8,0,2], [8,4,3], [8,4,3], [8,5,2], [8,5,2], [8,6,3], [8,6,3], [8,7,2], [8,7,2], [8,8,3], [8,8,3], [8,9,2], [8,9,2], [8,16,3], [8,16,3], [8,17,2], [8,21,3], [8,21,3], [8,22,2], [8,22,2], [8,27,3], [8,28,3], [8,28,2], [8,28,2], [8,29,2], [8,32,3], [8,33,2], [8,37,3], [8,37,3], [8,38,2], [8,38,2], [8,40,3], [8,40,3], [8,41,2], [8,41,2], [8,43,3], [8,44,2], [8,44,2], [8,48,3], [8,49,2], [8,51,3], [8,52,2], [8,52,2], [8,54,3], [8,54,3], [8,55,2], [8,55,2],
                [9,2,3], [9,2,3], [9,3,2], [9,3,2], [9,8,3], [9,9,2], [9,9,2], [9,11,3], [9,11,3], [9,12,2], [9,12,2], [9,18,3], [9,18,3], [9,19,2], [9,19,2], [9,20,3], [9,21,2], [9,21,2], [9,23,3], [9,24,2], [9,24,2], [9,27,3], [9,28,2], [9,28,2], [9,34,3], [9,34,3], [9,35,2], [9,38,3], [9,38,3], [9,39,2], [9,39,2], [9,43,3], [9,43,3], [9,44,2], [9,44,2], [9,48,3], [9,49,2], [9,49,2], [9,55,3], [9,55,3], [9,56,2], [9,56,2],
                [10,1,3], [10,2,2], [10,2,2], [10,6,3], [10,6,3], [10,7,2], [10,7,2], [10,14,3], [10,15,2], [10,15,2], [10,25,3], [10,25,3], [10,26,2], [10,26,2], [10,33,3], [10,33,3], [10,34,2], [10,34,2], [10,40,3], [10,41,2], [10,41,2], [10,45,3], [10,45,3], [10,46,2], [10,46,2], [10,52,3], [10,52,3], [10,53,2], [10,53,2],
                [11,0,3], [11,1,2], [11,1,3], [11,1,3], [11,2,2], [11,2,2], [11,6,3], [11,6,3], [11,7,2], [11,7,2], [11,14,3], [11,15,2], [11,15,2], [11,25,3], [11,25,3], [11,26,2], [11,26,2], [11,33,3], [11,33,3], [11,34,2], [11,34,2], [11,40,3], [11,41,2], [11,41,2], [11,45,3], [11,45,3], [11,46,2], [11,46,2], [11,52,3], [11,52,3], [11,53,2], [11,53,2], [11,59,3], [11,59,3],
                [12,0,2], [12,0,2], [12,6,3], [12,6,3], [12,7,2], [12,7,2], [12,14,3], [12,15,2], [12,15,2], [12,25,3], [12,25,3], [12,26,2], [12,26,2], [12,33,3], [12,33,3], [12,34,2], [12,34,2], [12,40,3], [12,41,2], [12,41,2], [12,45,3], [12,45,3], [12,46,2], [12,46,2], [12,52,3], [12,52,3], [12,53,2], [12,53,2],
                [13,0,3], [13,1,2], [13,2,3], [13,3,2], [13,3,2], [13,6,3], [13,6,3], [13,7,2], [13,7,2], [13,14,3], [13,15,2], [13,15,2], [13,25,3], [13,25,3], [13,26,2], [13,26,2], [13,33,3], [13,33,3], [13,34,2], [13,34,2], [13,40,3], [13,41,2], [13,41,2], [13,45,3], [13,45,3], [13,46,2], [13,46,2], [13,52,3], [13,52,3], [13,53,2], [13,53,2], [13,55,3], [13,56,2],
                [14,1,3], [14,2,2], [14,2,2], [14,6,3], [14,6,3], [14,7,2], [14,7,2], [14,14,3], [14,15,2], [14,15,2], [14,23,3], [14,24,2], [14,25,3], [14,25,3], [14,26,2], [14,26,2], [14,33,3], [14,33,3], [14,34,2], [14,34,2], [14,40,3], [14,41,2], [14,41,2], [14,45,3], [14,45,3], [14,46,2], [14,46,2], [14,52,3], [14,52,3], [14,53,2], [14,53,2],
                [15,1,3], [15,1,3], [15,2,2], [15,2,2], [15,6,3], [15,6,3], [15,7,2], [15,7,2], [15,14,3], [15,15,2], [15,15,2], [15,22,3], [15,23,2], [15,23,2], [15,30,3], [15,30,3], [15,31,2], [15,31,2], [15,35,3], [15,35,3], [15,36,2], [15,36,2], [15,41,3], [15,41,3], [15,42,2], [15,42,2], [15,47,3], [15,47,3], [15,48,2], [15,48,2], [15,54,3], [15,55,2], [15,55,2],
                [16,1,3], [16,1,3], [16,2,2], [16,2,2], [16,7,3], [16,7,3], [16,8,2], [16,8,2], [16,13,3], [16,14,2], [16,18,3], [16,19,2], [16,19,2], [16,19,3], [16,20,2], [16,20,2], [16,28,3], [16,29,2], [16,29,2], [16,33,3], [16,33,3], [16,34,2], [16,34,2], [16,42,3], [16,42,3], [16,43,2], [16,43,2], [16,48,3], [16,48,3], [16,49,2], [16,49,2], [16,57,3], [16,57,3], [16,58,2], [16,58,2],
                [17,0,3], [17,1,2], [17,1,2], [17,3,3], [17,4,2], [17,4,2], [17,7,3], [17,8,2], [17,8,2], [17,10,3], [17,10,3], [17,11,2], [17,11,2], [17,13,3], [17,14,2], [17,18,3], [17,18,3], [17,19,2], [17,19,2], [17,22,3], [17,22,3], [17,23,2], [17,23,2], [17,28,3], [17,28,3], [17,29,2], [17,29,2], [17,34,3], [17,34,3], [17,35,2], [17,35,2], [17,39,3], [17,39,3], [17,40,2], [17,40,2], [17,41,3], [17,41,3], [17,42,2], [17,42,2], [17,49,3], [17,50,2], [17,50,2], [17,54,3], [17,54,3], [17,55,2], [17,55,2], [17,56,2], [17,58,3], [17,58,3], [17,59,2], [17,59,2],
                [18,0,3], [18,0,3], [18,1,2], [18,1,2], [18,5,3], [18,5,3], [18,6,2], [18,6,2], [18,12,3], [18,13,2], [18,13,2], [18,21,3], [18,21,3], [18,22,2], [18,22,2], [18,26,3], [18,26,3], [18,27,2], [18,27,2], [18,32,3], [18,32,3], [18,33,2], [18,33,2], [18,37,3], [18,38,2], [18,38,2], [18,42,3], [18,42,3], [18,43,2], [18,43,2], [18,50,3], [18,50,3], [18,51,2], [18,51,2], [18,56,3], [18,56,3], [18,57,2], [18,57,2], [18,58,3], [18,59,2], [18,59,2],
                [19,8,3], [19,9,2], [19,9,2], [19,18,3], [19,18,3], [19,19,2], [19,19,2], [19,24,3], [19,24,3], [19,25,2], [19,25,2], [19,31,3], [19,31,3], [19,32,2], [19,32,2], [19,38,3], [19,39,2], [19,39,2], [19,40,3], [19,40,3], [19,41,2], [19,41,2], [19,50,3], [19,50,3], [19,51,2], [19,51,2], [19,54,3], [19,54,3], [19,55,2], [19,55,2], [19,59,3],
                [20,0,2], [20,0,2], [20,8,3], [20,9,2], [20,9,2], [20,15,3], [20,15,3], [20,16,2], [20,16,2], [20,23,3], [20,23,3], [20,24,2], [20,24,2], [20,27,3], [20,28,2], [20,35,3], [20,35,3], [20,36,2], [20,36,2], [20,38,3], [20,39,2], [20,39,2], [20,48,3], [20,48,3], [20,49,2], [20,49,2], [20,56,3], [20,57,2], [20,57,2],
                [21,3,3], [21,4,2], [21,4,2], [21,9,3], [21,10,2], [21,10,2], [21,26,3], [21,27,2], [21,27,2], [21,33,3], [21,34,2], [21,34,2], [21,48,3], [21,48,3], [21,49,2], [21,49,2], [21,52,3], [21,53,2],
                [22,3,3], [22,4,2], [22,8,3], [22,9,2], [22,9,2], [22,26,3], [22,27,2], [22,35,3], [22,36,2], [22,45,3], [22,46,2]
            ],
            saturday: [
                [6,20,3], [6,21,2], [6,31,3], [6,32,2], [6,32,2], [6,36,3], [6,37,2], [6,37,2], [6,51,3], [6,51,3], [6,52,2], [6,52,2], [6,57,3],
                [7,0,3], [7,0,3], [7,1,2], [7,1,2], [7,11,3], [7,11,3], [7,12,2], [7,12,2], [7,12,2], [7,16,3], [7,17,2], [7,17,2], [7,29,3], [7,29,3], [7,30,2], [7,30,2], [7,30,2], [7,40,3], [7,40,3], [7,41,2], [7,41,2], [7,51,3], [7,51,3], [7,52,2], [7,52,2], [7,52,2], [7,53,3], [7,54,2], [7,54,2], [7,57,3], [7,58,2], [7,58,2],
                [8,9,3], [8,9,3], [8,10,2], [8,10,2], [8,12,3], [8,12,3], [8,13,2], [8,13,2], [8,13,2], [8,25,3], [8,25,3], [8,26,2], [8,26,2], [8,26,2], [8,36,3], [8,36,3], [8,37,2], [8,37,2], [8,37,2], [8,41,3], [8,42,2], [8,42,2], [8,49,3], [8,49,3], [8,50,2], [8,50,2], [8,50,2], [8,55,3], [8,55,3], [8,56,2], [8,56,2], [8,59,3],
                [9,0,2], [9,0,2], [9,9,3], [9,9,3], [9,10,2], [9,10,2], [9,19,3], [9,19,3], [9,20,2], [9,20,2], [9,20,2], [9,31,3], [9,31,3], [9,32,2], [9,32,2], [9,43,3], [9,43,3], [9,44,2], [9,44,2], [9,49,3], [9,49,3], [9,50,2], [9,50,2], [9,50,2], [9,51,2], [9,57,3], [9,58,2],
                [10,9,3], [10,9,3], [10,10,2], [10,10,2], [10,20,3], [10,20,3], [10,21,2], [10,21,2], [10,31,3], [10,31,3], [10,32,2], [10,32,2], [10,45,3], [10,46,2], [10,46,2], [10,49,3], [10,49,3], [10,50,2], [10,50,2],
                [11,1,3], [11,1,3], [11,2,2], [11,2,2], [11,13,3], [11,13,3], [11,14,2], [11,14,2], [11,18,3], [11,18,3], [11,19,2], [11,19,2], [11,19,2], [11,35,3], [11,35,3], [11,36,2], [11,36,2], [11,49,3], [11,49,3], [11,50,2], [11,50,2], [11,58,3], [11,58,3], [11,59,2], [11,59,2],
                [12,1,3], [12,1,3], [12,2,2], [12,2,2], [12,13,3], [12,13,3], [12,14,2], [12,14,2], [12,28,3], [12,28,3], [12,29,2], [12,29,2], [12,29,2], [12,39,3], [12,39,3], [12,40,2], [12,40,2], [12,49,3], [12,49,3], [12,50,2], [12,50,2], [12,54,2],
                [13,4,3], [13,4,3], [13,5,2], [13,5,2], [13,11,3], [13,11,3], [13,12,2], [13,12,2], [13,12,2], [13,20,3], [13,20,3], [13,21,2], [13,21,2], [13,39,3], [13,39,3], [13,40,2], [13,40,2], [13,49,3], [13,49,3], [13,50,2], [13,50,2], [13,53,3], [13,54,2], [13,54,2],
                [14,4,3], [14,4,3], [14,5,2], [14,5,2], [14,16,3], [14,17,2], [14,17,2], [14,28,3], [14,28,3], [14,29,2], [14,29,2], [14,29,2], [14,39,3], [14,39,3], [14,40,2], [14,40,2], [14,49,3], [14,49,3], [14,50,2], [14,50,2], [14,55,2], [14,55,3],
                [15,1,3], [15,1,3], [15,2,2], [15,2,2], [15,4,3], [15,4,3], [15,5,2], [15,5,2], [15,15,2], [15,15,3], [15,16,3], [15,16,3], [15,17,2], [15,17,2], [15,31,3], [15,31,3], [15,32,2], [15,32,2], [15,32,2], [15,39,3], [15,39,3], [15,40,2], [15,40,2], [15,49,3], [15,49,3], [15,50,2], [15,50,2],
                [16,3,3], [16,3,3], [16,4,2], [16,4,2], [16,4,3], [16,4,3], [16,5,2], [16,5,2], [16,5,2], [16,16,3], [16,16,3], [16,17,2], [16,17,2], [16,29,3], [16,29,3], [16,30,2], [16,30,2], [16,30,2], [16,39,3], [16,39,3], [16,40,2], [16,40,2], [16,49,3], [16,49,3], [16,50,2], [16,50,2],
                [17,0,3], [17,0,3], [17,1,2], [17,1,2], [17,6,3], [17,6,3], [17,7,2], [17,7,2], [17,7,2], [17,16,3], [17,16,3], [17,17,2], [17,17,2], [17,29,3], [17,29,3], [17,30,2], [17,30,2], [17,30,2], [17,37,3], [17,37,3], [17,38,2], [17,38,2], [17,49,3], [17,49,3], [17,50,2], [17,50,2], [17,55,2], [17,55,3], [17,57,3], [17,58,2], [17,58,2],
                [18,5,3], [18,5,3], [18,6,2], [18,6,2], [18,6,2], [18,16,3], [18,16,3], [18,17,2], [18,17,2], [18,32,3], [18,32,3], [18,33,2], [18,33,2], [18,39,3], [18,39,3], [18,40,2], [18,40,2], [18,40,2], [18,49,3], [18,49,3], [18,50,2], [18,50,2], [18,54,3], [18,55,2], [18,55,2],
                [19,7,3], [19,7,3], [19,8,2], [19,8,2], [19,8,2], [19,15,3], [19,15,3], [19,16,2], [19,16,2], [19,27,3], [19,27,3], [19,28,2], [19,28,2], [19,28,2], [19,33,3], [19,34,2], [19,34,2], [19,46,3], [19,47,2], [19,47,2], [19,48,3], [19,49,2], [19,49,2],
                [20,2,3], [20,2,3], [20,3,2], [20,3,2], [20,3,2], [20,13,3], [20,13,3], [20,14,2], [20,14,2], [20,28,3], [20,29,2], [20,29,2], [20,34,3], [20,35,2], [20,35,2], [20,48,3], [20,49,2], [20,49,2], [20,51,3], [20,52,2],
                [21,4,3], [21,4,3], [21,5,2], [21,5,2], [21,5,2], [21,13,3], [21,13,3], [21,14,2], [21,14,2], [21,28,3], [21,29,2], [21,29,2], [21,36,3], [21,37,2], [21,37,2], [21,48,3], [21,49,2], [21,49,2], [21,58,3], [21,59,2], [21,59,2],
                [22,15,3], [22,16,2], [22,16,2], [22,26,3], [22,27,2], [22,27,2], [22,44,3], [22,45,2]
            ]
        };
        // æ—¥æ›œç¥æ—¥ã‚‚åœŸæ›œã¨åŒã˜ã¨ã™ã‚‹
        rawSchedule.holiday = rawSchedule.saturday;

        function getScheduleForToday() {
            const day = new Date().getDay(); // 0:æ—¥, 6:åœŸ
            const isSaturday = (day === 6);
            const isHoliday = (day === 0);
            
            if (isHoliday) {
                document.getElementById('day-type').innerText = "ï¼ˆæ—¥æ›œãƒ»ç¥æ—¥ãƒ€ã‚¤ãƒ¤ï¼‰";
                return rawSchedule.holiday;
            } else if (isSaturday) {
                document.getElementById('day-type').innerText = "ï¼ˆåœŸæ›œãƒ€ã‚¤ãƒ¤ï¼‰";
                return rawSchedule.saturday;
            } else {
                document.getElementById('day-type').innerText = "ï¼ˆå¹³æ—¥ãƒ€ã‚¤ãƒ¤ï¼‰";
                return rawSchedule.weekday;
            }
        }

        function updateApp() {
            // ç¾åœ¨æ™‚åˆ»
            const now = new Date();
            const currentHours = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentSeconds = now.getSeconds();

            document.getElementById('current-time').innerText = 
                `${String(currentHours).padStart(2, '0')}:${String(currentMinutes).padStart(2, '0')}:${String(currentSeconds).padStart(2, '0')}`;

            // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å–å¾— & é‡è¤‡å‰Šé™¤ & ã‚½ãƒ¼ãƒˆ
            const schedule = getScheduleForToday();
            const uniqueSchedule = [];
            const seen = new Set();
            for(let item of schedule) {
                const key = item[0] + ":" + item[1] + ":" + item[2];
                if(!seen.has(key)) {
                    seen.add(key);
                    uniqueSchedule.push(item);
                }
            }
            uniqueSchedule.sort((a,b) => (a[0]*60+a[1]) - (b[0]*60+b[1]));

            let nextBus = null;
            let nextNextBus = null;

            // æ¬¡ã®ãƒã‚¹æ¢ç´¢
            for (let i = 0; i < uniqueSchedule.length; i++) {
                const [h, m, stop] = uniqueSchedule[i];
                if (h > currentHours || (h === currentHours && m > currentMinutes)) {
                    nextBus = { h, m, stop };
                    if (i + 1 < uniqueSchedule.length) {
                        const [nh, nm, nstop] = uniqueSchedule[i+1];
                        nextNextBus = { h: nh, m: nm, stop: nstop };
                    }
                    break;
                }
            }

            const body = document.getElementById('app-body');
            const statusEl = document.getElementById('status');
            const timerEl = document.getElementById('timer');
            const stopEl = document.getElementById('stop-number');
            const nextTimeEl = document.getElementById('next-bus-time');
            const nextNextEl = document.getElementById('next-next-bus');

            if (!nextBus) {
                body.className = "out";
                statusEl.innerText = "æœ¬æ—¥ã®ãƒã‚¹çµ‚äº†";
                timerEl.innerText = "--:--";
                stopEl.innerText = "-";
                return;
            }

            // æ®‹ã‚Šæ™‚é–“è¨ˆç®—
            const busDate = new Date();
            busDate.setHours(nextBus.h, nextBus.m, 0);
            if (busDate < now) busDate.setDate(busDate.getDate() + 1);

            const diffMs = busDate - now;
            const diffMin = Math.floor(diffMs / 1000 / 60);
            const diffSec = Math.floor((diffMs / 1000) % 60);

            // ç”»é¢æ›´æ–°
            timerEl.innerText = `${diffMin}:${String(diffSec).padStart(2, '0')}`;
            stopEl.innerText = nextBus.stop;
            nextTimeEl.innerText = `${String(nextBus.h).padStart(2, '0')}:${String(nextBus.m).padStart(2, '0')}`;
            
            if (nextNextBus) {
                nextNextEl.innerText = `ãã®æ¬¡ã¯ ${String(nextNextBus.h).padStart(2, '0')}:${String(nextNextBus.m).padStart(2, '0')} (ã®ã‚Šã°${nextNextBus.stop})`;
            } else {
                nextNextEl.innerText = "æœ€çµ‚ãƒã‚¹ã§ã™";
            }

            // â˜…è‰²åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (ä¹—ã‚Šå ´ã”ã¨ã«æ™‚é–“ã‚’å¤‰ãˆã‚‹)
            // è¨­å®šå€¤ã‚’å–å¾— (ãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ5åˆ†)
            const limit2 = parseInt(document.getElementById('walk-time-2').value) || 5;
            const limit3 = parseInt(document.getElementById('walk-time-3').value) || 5;
            
            // æ¬¡ã®ãƒã‚¹ã®ä¹—ã‚Šå ´ã«åˆã‚ã›ã¦åˆ¶é™æ™‚é–“ã‚’å¤‰ãˆã‚‹
            const limit = (nextBus.stop === 2) ? limit2 : limit3;

            if (diffMin < limit) {
                body.className = "out";
                statusEl.innerText = "ã‚‚ã†é–“ã«åˆã‚ãªã„ï¼";
            } else if (diffMin < limit + 3) {
                body.className = "hurry";
                statusEl.innerText = "ãƒ€ãƒƒã‚·ãƒ¥ãªã‚‰é–“ã«åˆã†ï¼";
            } else {
                body.className = "safe";
                statusEl.innerText = "ã¾ã ä½™è£•ã‚ã‚Š";
            }
        }

        setInterval(updateApp, 1000);
        window.onload = function() {
            loadSettings();
            updateApp();
        };
    </script>
</body>
</html>

